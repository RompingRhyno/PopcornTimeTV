//
//  MoviesViewModel.swift
//  PopcornTimetvOS SwiftUI
//
//  Created by Alexandru Tudose on 19.06.2021.
//  Copyright © 2021 PopcornTime. All rights reserved.
//

import Foundation
import PopcornKit

class MoviesViewModel: ObservableObject {
    var page = 1
    @Published var hasNextPage = false
    @Published var currentFilter: Popcorn.Filters = .trending {
        didSet { reload() }
    }
    @Published var currentGenre = Popcorn.Genres.all {
        didSet { reload() }
    }
    @Published var error: Error? = nil
    @Published var movies: [Movie] = []
    var lastReloadDate: Date?
    var task: Task<(), Never>?
    var isLoading: Bool {
        task != nil
    }
    
    func reload() {
        movies = []
        page = 1
        task?.cancel()
        task = nil
        loadMovies()
    }
    
    func loadMore() {
        guard hasNextPage && !isLoading else {
            return
        }
        
        loadMovies()
    }
    
    func loadMovies() {
        guard !isLoading else {
            return
        }
        
        self.task = Task { @MainActor in
            self.error = nil
            do {
                let movies = try await PopcornKit.loadMovies(page, filterBy: currentFilter, genre: currentGenre)
    //            print(movies)
    //            print(movies.toJSONString())
                    
                if page == 1 {
                    lastReloadDate = Date()
                }
                
                self.movies = (self.movies + movies).uniqueById()
                self.hasNextPage = !movies.isEmpty
                self.page += 1
            } catch {
                // A server with the specified hostname could not be found.
                // try to find alternative servers
                if let error = error as NSError?, error.code == -1003,
                   await PopcornKit.handleServerWasMoved() {
                    self.task = nil
                    self.loadMovies() // try again
                } else {
                    self.error = error
                }
            }
            self.task = nil
        }
    }
    
    func appDidBecomeActive() {
        let _4Hours = 4 * 60 * 60.0
        if _4Hours < abs(lastReloadDate?.timeIntervalSinceNow ?? 0)  {
            self.reload()
        }
    }
}


extension Movie {
    static func dummy(ratings: Ratings? = nil) -> Self {
        var movie = Movie.dummiesFromJSON()[0]
        movie.actors = .init(JSONArray: movieActorsJSON)
        movie.crew = .init(JSONArray: movieCrewJSON)
        movie.related = .init(JSONArray: movieRelatedJSON)
        movie.ratings = ratings
        return movie
    }
    
    static func dummiesFromJSON() -> [Movie] {
        return .init(JSONArray: moviesJSON)
    }
}

let movieCrewJSON: [[String: Any]] = [["person": ["name": "Ian Shorr", "ids": ["imdb": "nm2135380", "tmdb": 82941]], "job": "Screenplay", "roleType": "writing"], ["job": "Screenstory", "roleType": "writing", "person": ["ids": ["tmdb": 1319500, "imdb": "nm2089442"], "name": "Todd Stein"]], ["person": ["ids": ["imdb": "nm0278475", "tmdb": 18265], "name": "Mauro Fiore"], "job": "Director of Photography", "roleType": "camera"], ["person": ["ids": ["imdb": "nm0119322", "tmdb": 3987], "name": "Conrad Buff IV"], "job": "Editor", "roleType": "unknown"], ["roleType": "production", "person": ["name": "Lorenzo Di Bonaventura", "ids": ["imdb": "nm0225146", "tmdb": 10952]], "job": "Producer"], ["person": ["name": "Mark Vahradian", "ids": ["tmdb": 24309, "imdb": "nm1680607"]], "roleType": "production", "job": "Producer"], ["person": ["ids": ["tmdb": 13240, "imdb": "nm0000242"], "name": "Mark Wahlberg"], "job": "Producer", "roleType": "production"], ["job": "Producer", "roleType": "production", "person": ["name": "Mark Huffam", "ids": ["imdb": "nm0400240", "tmdb": 8401]]], ["person": ["ids": ["tmdb": 183044, "imdb": "nm0506100"], "name": "Stephen Levinson"], "roleType": "production", "job": "Producer"], ["job": "Director", "roleType": "directing", "person": ["name": "Antoine Fuqua", "ids": ["tmdb": 20907, "imdb": "nm0298807"]]], ["job": "Executive Producer", "roleType": "production", "person": ["ids": ["imdb": "nm0298807", "tmdb": 20907], "name": "Antoine Fuqua"]]]

let movieActorsJSON: [[String: Any]] = [["person": ["name": "Dylan O\'Brien", "ids": ["imdb": "nm3729721", "tmdb": 527393]], "character": "Heinrich Treadway"], ["person": ["ids": ["tmdb": 13240, "imdb": "nm0000242"], "name": "Mark Wahlberg"], "character": "Evan McCauley"], ["character": "Bathurst 1985", "person": ["ids": ["tmdb": 36669, "imdb": "nm1670029"], "name": "Rupert Friend"]], ["person": ["name": "Sophie Cookson", "ids": ["tmdb": 1282054, "imdb": "nm5824400"]], "character": "Nora Brightman"], ["person": ["name": "Chiwetel Ejiofor", "ids": ["imdb": "nm0252230", "tmdb": 5294]], "character": "Bathurst 2020"], ["person": ["name": "Toby Jones", "ids": ["imdb": "nm0429363", "tmdb": 13014]], "character": "Bryan Porter"], ["person": ["ids": ["tmdb": 1232690, "imdb": "nm4419317"], "name": "Liz Carr"], "character": "Garrick"], ["person": ["name": "Wallis Day", "ids": ["tmdb": 1715541, "imdb": "nm5363417"]], "character": "Shin"], ["person": ["ids": ["imdb": "nm3433735", "tmdb": 116264], "name": "Tom Hughes"], "character": "Abel"], ["person": ["ids": ["tmdb": 1399750, "imdb": "nm3664502"], "name": "Kae Alexander"], "character": "Trace"], ["character": "Artisan", "person": ["name": "Jason Mantzoukas", "ids": ["tmdb": 111683, "imdb": "nm1727621"]]], ["person": ["name": "Joana Ribeiro", "ids": ["tmdb": 1686493, "imdb": "nm4940278"]], "character": "Leona"], ["person": ["ids": ["tmdb": 3107735, "imdb": "nm10435035"], "name": "Lillia Langley"], "character": "Modern Day Girl"], ["person": ["ids": ["imdb": "nm5380206", "tmdb": 1503909], "name": "Raffiella Chapman"], "character": "Jinya"], ["character": "Kovic", "person": ["ids": ["tmdb": 238164, "imdb": "nm1778512"], "name": "Jóhannes Haukur Jóhannesson"]]]

let movieRelatedJSON: [[String: Any]] = [["rating": ["percentage": 0.0], "year": "2021", "title": "Infinite", "synopsis": "A troubled young man haunted by memories of two past lives stumbles upon the centuries-old secret society of similar individuals and dares to join their ranks.", "certification": "PG-13", "genres": ["action", "adventure", "drama", "science fiction"], "runtime": "106", "imdb_id": "tt6654210", "images": ["poster": "http://image.tmdb.org/t/p/w780/niw2AKHz6XmwiRMLWaoyAOAti0G.jpg", "fanart": "http://image.tmdb.org/t/p/original/wjQXZTlFM3PVEUmKf1sUajjygqT.jpg"], "trailer": "http://www.youtube.com/watch?v=zI2qbr99H64"]]

let moviesJSON: [[String: Any]] =
    [["trailer": "http://www.youtube.com/watch?v=zI2qbr99H64", "year": "2021", "certification": "PG-13", "rating": ["percentage": 0.0], "genres": ["action", "adventure", "drama", "science fiction"], "runtime": "106", "synopsis": "A troubled young man haunted by memories of two past lives stumbles upon the centuries-old secret society of similar individuals and dares to join their ranks.", "title": "Infinite", "imdb_id": "tt6654210", "images": ["fanart": "http://image.tmdb.org/t/p/original/wjQXZTlFM3PVEUmKf1sUajjygqT.jpg", "poster": "http://image.tmdb.org/t/p/w780/niw2AKHz6XmwiRMLWaoyAOAti0G.jpg"]], ["images": ["poster": "http://image.tmdb.org/t/p/w780/YxopfHpsCV1oF8CZaL4M3Eodqa.jpg", "fanart": "http://image.tmdb.org/t/p/original/70AV2Xx5FQYj20labp0EGdbjI6E.jpg"], "imdb_id": "tt11083552", "runtime": "118", "genres": ["action", "crime"], "year": "2021", "rating": ["percentage": 77.0], "synopsis": "A cold and mysterious new security guard for a Los Angeles cash truck company surprises his co-workers when he unleashes precision skills during a heist. The crew is left wondering who he is and where he came from. Soon, the marksman\'s ultimate motive becomes clear as he takes dramatic and irrevocable steps to settle a score.", "certification": "R", "trailer": "http://www.youtube.com/watch?v=EFYEni2gsK0", "title": "Wrath of Man"], ["synopsis": "Hutch Mansell, a suburban dad, overlooked husband, nothing neighbor — a \"nobody.\" When two thieves break into his home one night, Hutch\'s unknown long-simmering rage is ignited and propels him on a brutal path that will uncover dark secrets he fought to leave behind.", "genres": ["action", "crime", "thriller"], "year": "2021", "runtime": "92", "title": "Nobody", "trailer": "http://www.youtube.com/watch?v=wZti8QKBWPo", "certification": "R", "imdb_id": "tt7888964", "rating": ["percentage": 77.0], "images": ["poster": "http://image.tmdb.org/t/p/w780/oBgWY00bEFeZ9N25wWVyuQddbAo.jpg", "fanart": "http://image.tmdb.org/t/p/original/sBwGOfJtSF6hlXaEgvFfBfeLqMk.jpg"]], ["title": "The Conjuring: The Devil Made Me Do It", "year": "2021", "imdb_id": "tt7069210", "certification": "R", "runtime": "112", "images": ["fanart": "http://image.tmdb.org/t/p/original/gr2bdQ12cK4VA7EaIgtmDcbdALP.jpg", "poster": "http://image.tmdb.org/t/p/w780/isghxwTkgHsSfoEmXK1QZEYTjUl.jpg"], "trailer": "http://www.youtube.com/watch?v=qc6jN1BcJi0", "synopsis": "Paranormal investigators Ed and Lorraine Warren encounter what would become one of the most sensational cases from their files. The fight for the soul of a young boy takes them beyond anything they\'d ever seen before, to mark the first time in U.S. history that a murder suspect would claim demonic possession as a defense.", "genres": ["horror", "mystery", "thriller"], "rating": ["percentage": 85.0]], ["genres": ["action", "science fiction"], "rating": ["percentage": 85.0], "synopsis": "In a time when monsters walk the Earth, humanity’s fight for its future sets Godzilla and Kong on a collision course that will see the two most powerful forces of nature on the planet collide in a spectacular battle for the ages.", "imdb_id": "tt5034838", "runtime": "113", "year": "2021", "trailer": "http://www.youtube.com/watch?v=odM92ap8_c0", "certification": "PG-13", "title": "Godzilla vs. Kong", "images": ["fanart": "http://image.tmdb.org/t/p/original/iopYFB1b6Bh7FWZh3onQhph1sih.jpg", "poster": "http://image.tmdb.org/t/p/w780/pgqgaUx1cJb5oZQQ5v0tNARCeBp.jpg"]], ["trailer": "http://www.youtube.com/watch?v=9BPMTr-NS9s", "genres": ["action", "adventure", "animation", "drama", "family", "fantasy"], "runtime": "107", "synopsis": "Long ago, in the fantasy world of Kumandra, humans and dragons lived together in harmony. But when an evil force threatened the land, the dragons sacrificed themselves to save humanity. Now, 500 years later, that same evil has returned and it’s up to a lone warrior, Raya, to track down the legendary last dragon to restore the fractured land and its divided people.", "certification": "PG", "rating": ["percentage": 84.0], "title": "Raya and the Last Dragon", "imdb_id": "tt5109280", "images": ["poster": "http://image.tmdb.org/t/p/w780/lPsD10PP4rgUGiGR4CCXA6iY0QQ.jpg", "fanart": "http://image.tmdb.org/t/p/original/7prYzufdIOy1KCTZKVWpjBFqqNr.jpg"], "year": "2021"], ["imdb_id": "tt4876134", "images": ["fanart": "http://image.tmdb.org/t/p/original/x4HhggDwAAWa9iaTmz0K622j5Fi.jpg", "poster": "http://image.tmdb.org/t/p/w780/khVFEq1nvkKmq4Nz6YC9muuDR1P.jpg"], "synopsis": "After being recruited by a group of unconventional thieves, renowned criminal Richard Pace finds himself caught up in an elaborate gold heist that promises to have far-reaching implications on his life and the lives of countless others.", "rating": ["percentage": 0.0], "runtime": "94", "year": "2021", "title": "The Misfits", "trailer": "http://www.youtube.com/watch?v=lxhMLjt83KQ", "certification": "R", "genres": ["action", "comedy", "crime"]], ["rating": ["percentage": 87.0], "title": "Cruella", "genres": ["comedy", "crime"], "imdb_id": "tt3228774", "certification": "PG-13", "trailer": "http://www.youtube.com/watch?v=gmRKv7n2If8", "year": "2021", "synopsis": "In 1970s London amidst the punk rock revolution, a young grifter named Estella is determined to make a name for herself with her designs. She befriends a pair of young thieves who appreciate her appetite for mischief, and together they are able to build a life for themselves on the London streets. One day, Estella’s flair for fashion catches the eye of the Baroness von Hellman, a fashion legend who is devastatingly chic and terrifyingly haute. But their relationship sets in motion a course of events and revelations that will cause Estella to embrace her wicked side and become the raucous, fashionable and revenge-bent Cruella.", "images": ["poster": "http://image.tmdb.org/t/p/w780/hjS9mH8KvRiGHgjk6VUZH7OT0Ng.jpg", "fanart": "http://image.tmdb.org/t/p/original/8ChCpCYxh9YXusmHwcE9YzP0TSG.jpg"], "runtime": "134"], ["runtime": "0", "genres": ["animation", "comedy", "family", "fantasy"], "rating": ["percentage": 85.0], "imdb_id": "tt5562070", "year": "2021", "certification": "", "synopsis": "Din, a working-class college student, and Long, a cynical but all-powerful dragon capable of granting wishes, set off on a hilarious adventure through modern day Shanghai in pursuit of Din\'s long-lost childhood friend, Lina.", "title": "Wish Dragon", "images": ["poster": "http://image.tmdb.org/t/p/w780/6UNHOWGOrXv8rlH3OFOMLjmQZgu.jpg", "fanart": "http://image.tmdb.org/t/p/original/yrfcpq5IE609THsBo9sQcCm7Wes.jpg"], "trailer": "http://www.youtube.com/watch?v=IGYscqWi12U"], ["title": "Spiral: From the Book of Saw", "synopsis": "Working in the shadow of an esteemed police veteran, brash Detective Ezekiel “Zeke” Banks and his rookie partner take charge of a grisly investigation into murders that are eerily reminiscent of the city’s gruesome past.  Unwittingly entrapped in a deepening mystery, Zeke finds himself at the center of the killer’s morbid game.", "trailer": "http://www.youtube.com/watch?v=ZgHHEqQPMb0", "certification": "R", "images": ["poster": "http://image.tmdb.org/t/p/w780/qkl6mRoFexK2FGWCbAsvrRxjWaF.jpg", "fanart": "http://image.tmdb.org/t/p/original/9kJwekzhcFoZKKtgSMeh0QJUkt4.jpg"], "runtime": "88", "genres": ["horror", "mystery", "thriller"], "rating": ["percentage": 0.0], "imdb_id": "tt10342730", "year": "2021"], ["imdb_id": "tt11762434", "year": "2021", "title": "Cosmic Sin", "certification": "R", "rating": ["percentage": 0.0], "genres": ["action", "science fiction"], "trailer": "http://www.youtube.com/watch?v=9HTWDnKs6hA", "images": ["fanart": "http://image.tmdb.org/t/p/original/yBO2gTuJ4gk4l5MhWusfuoUgbdS.jpg", "poster": "http://image.tmdb.org/t/p/w780/6Wm7P6y22UZA40QuPYHyWyJ6leI.jpg"], "runtime": "93", "synopsis": "Seven rogue soldiers launch a preemptive strike against a newly discovered alien civilization in the hopes of ending an interstellar war before it starts."], ["runtime": "97", "rating": ["percentage": 60.0], "imdb_id": "tt8372094", "year": "2021", "synopsis": "Frederick Fitzell is living his best life—until he starts having horrific visions of Cindy, a girl who vanished in high school. After reaching out to old friends with whom he used to take a mystery drug called Mercury, Fredrick realizes the only way to stop the visions lies deep within his own memories, so he embarks on a terrifying mental odyssey to learn the truth.", "trailer": "http://www.youtube.com/watch?v=Bum0t2CbAak", "title": "Flashback", "certification": "R", "genres": ["drama", "mystery", "thriller"], "images": ["poster": "http://image.tmdb.org/t/p/w780/nc7szo7ChOknEk8qCkABJyNgl5y.jpg", "fanart": "http://image.tmdb.org/t/p/original/2VBf6N8deNZIWAMGvR7Pu62D5Al.jpg"]], ["synopsis": "Following the events at home, the Abbott family now face the terrors of the outside world. Forced to venture into the unknown, they realize that the creatures that hunt by sound are not the only threats that lurk beyond the sand path.", "rating": ["percentage": 73.0], "imdb_id": "tt8332922", "trailer": "http://www.youtube.com/watch?v=XEMwSdne6UE", "certification": "PG-13", "year": "2021", "title": "A Quiet Place Part II", "images": ["fanart": "http://image.tmdb.org/t/p/original/z2UtGA1WggESspi6KOXeo66lvLx.jpg", "poster": "http://image.tmdb.org/t/p/w780/4q2hz2m8hubgvijz8Ez0T2Os2Yv.jpg"], "runtime": "97", "genres": ["horror", "science fiction", "thriller"]], ["genres": ["action", "adventure", "fantasy", "science fiction"], "title": "Zack Snyder\'s Justice League", "images": ["poster": "http://image.tmdb.org/t/p/w780/tnAuB8q5vv7Ax9UAEje5Xi4BXik.jpg", "fanart": "http://image.tmdb.org/t/p/original/43NwryODVEsbBDC0jK3wYfVyb5q.jpg"], "runtime": "242", "synopsis": "Determined to ensure Superman\'s ultimate sacrifice was not in vain, Bruce Wayne aligns forces with Diana Prince with plans to recruit a team of metahumans to protect the world from an approaching threat of catastrophic proportions.", "rating": ["percentage": 83.0], "year": "2021", "trailer": "http://www.youtube.com/watch?v=vM-Bja2Gy04", "certification": "R", "imdb_id": "tt12361974"], ["genres": ["comedy", "documentary", "tv movie"], "synopsis": "The cast of Friends reunites for a once-in-a-lifetime celebration of the hit series, an unforgettable evening filled with iconic memories, uncontrollable laughter, happy tears, and special guests.", "year": "2021", "imdb_id": "tt11337862", "certification": "", "images": ["poster": "http://image.tmdb.org/t/p/w780/l00ff9dmop1UBfb4QNrLMQl5fgc.jpg", "fanart": "http://image.tmdb.org/t/p/original/sF19W36JtRIhAm3VciggSkzBtt.jpg"], "trailer": "http://www.youtube.com/watch?v=HRXVQ77ehRQ", "title": "Friends: The Reunion", "runtime": "104", "rating": ["percentage": 83.0]], ["certification": "R", "genres": ["action", "crime", "thriller"], "year": "2020", "rating": ["percentage": 73.0], "synopsis": "Learning that a legendary lost treasure will be deposited in the bank\'s safe for just 10 days, Thom masterminds a meticulous plan along with charismatic art dealer Walter to break into the Bank. But they have only 90 minutes to do so, when the bank\'s staff will be mightily distracted by the 2010 soccer World Cup final.", "imdb_id": "tt9742794", "runtime": "118", "images": ["poster": "http://image.tmdb.org/t/p/w780/ocINPt8wAKZVMZERmnXII0LnjWB.jpg", "fanart": "http://image.tmdb.org/t/p/original/dLz5CS6ExcePRpqXGnLBz5OSeW5.jpg"], "title": "The Vault", "trailer": "http://www.youtube.com/watch?v=h0vn8PyE4-Q"], ["imdb_id": "tt1959563", "synopsis": "The world\'s top bodyguard gets a new client, a hit man who must testify at the International Court of Justice. They must put their differences aside and work together to make it to the trial on time.", "trailer": "http://www.youtube.com/watch?v=IpKmt4MpctM", "genres": ["action", "comedy", "crime", "thriller"], "images": ["fanart": "http://image.tmdb.org/t/p/original/7KsqfXDECZMryX1Rv4RKsT7SIjQ.jpg", "poster": "http://image.tmdb.org/t/p/w780/5CGjlz2vyBhW5xHW4eNOZIdgzYq.jpg"], "rating": ["percentage": 68.0], "year": "2017", "certification": "R", "title": "The Hitman\'s Bodyguard", "runtime": "118"], ["imdb_id": "tt6644200", "images": ["fanart": "http://image.tmdb.org/t/p/original/roYyPiQDQKmIKUEhO912693tSja.jpg", "poster": "http://image.tmdb.org/t/p/w780/nAU74GmpUk7t5iklEp3bufwDq4n.jpg"], "title": "A Quiet Place", "runtime": "91", "trailer": "http://www.youtube.com/watch?v=WR7cc5t7tv8", "year": "2018", "synopsis": "A family is forced to live in silence while hiding from creatures that hunt by sound.", "certification": "PG-13", "rating": ["percentage": 74.0], "genres": ["drama", "horror", "science fiction"]], ["synopsis": "When Dr. Indiana Jones – the tweed-suited professor who just happens to be a celebrated archaeologist – is hired by the government to locate the legendary Ark of the Covenant, he finds himself up against the entire Nazi regime.", "trailer": "http://www.youtube.com/watch?v=XkkzKHCx154", "imdb_id": "tt0082971", "title": "Raiders of the Lost Ark", "certification": "PG", "genres": ["action", "adventure"], "images": ["poster": "http://image.tmdb.org/t/p/w780/ceG9VzoRAVGwivFU403Wc3AHRys.jpg", "fanart": "http://image.tmdb.org/t/p/original/kCiMExsYuNhYluHxPP2OTmWw7hp.jpg"], "year": "1981", "runtime": "115", "rating": ["percentage": 79.0]], ["runtime": "95", "trailer": "http://www.youtube.com/watch?v=GkXeVIfbJOw", "year": "2020", "certification": "PG", "genres": ["animation", "comedy", "family", "fantasy"], "synopsis": "Searching for a safer habitat, the prehistoric Crood family discovers an idyllic, walled-in paradise that meets all of its needs. Unfortunately, they must also learn to live with the Bettermans -- a family that\'s a couple of steps above the Croods on the evolutionary ladder. As tensions between the new neighbors start to rise, a new threat soon propels both clans on an epic adventure that forces them to embrace their differences, draw strength from one another, and survive together.", "title": "The Croods: A New Age", "imdb_id": "tt2850386", "rating": ["percentage": 75.0], "images": ["poster": "http://image.tmdb.org/t/p/w780/tbVZ3Sq88dZaCANlUcewQuHQOaE.jpg", "fanart": "http://image.tmdb.org/t/p/original/cjaOSjsjV6cl3uXdJqimktT880L.jpg"]], ["rating": ["percentage": 85.0], "certification": "PG-13", "imdb_id": "tt8503618", "images": ["fanart": "http://image.tmdb.org/t/p/original/uWVkEo9PWHu9algZsiLPi6sRU64.jpg", "poster": "http://image.tmdb.org/t/p/w780/h1B7tW0t399VDjAcWJh8m87469b.jpg"], "year": "2020", "runtime": "160", "trailer": "http://www.youtube.com/watch?v=DSCKfXpAGHc", "genres": ["drama", "history", "music"], "title": "Hamilton", "synopsis": "Presenting the tale of American founding father Alexander Hamilton, this filmed version of the original Broadway smash hit is the story of America then, told by America now."], ["runtime": "148", "rating": ["percentage": 68.0], "year": "2021", "trailer": "http://www.youtube.com/watch?v=tI1JGPhYBS8", "genres": ["action", "horror", "thriller"], "certification": "R", "synopsis": "Following a zombie outbreak in Las Vegas, a group of mercenaries take the ultimate gamble: venturing into the quarantine zone to pull off the greatest heist ever attempted.", "images": ["poster": "http://image.tmdb.org/t/p/w780/x3taBaWfRzw1NIKhEPpKPwKBAOC.jpg", "fanart": "http://image.tmdb.org/t/p/original/c0izdYdnTe4uMRifHgvTA85wPz0.jpg"], "imdb_id": "tt0993840", "title": "Army of the Dead"], ["imdb_id": "tt3215824", "rating": ["percentage": 73.0], "synopsis": "A teenage murder witness finds himself pursued by twin assassins in the Montana wilderness with a survival expert tasked with protecting him - and a forest fire threatening to consume them all.", "year": "2021", "runtime": "100", "genres": ["action", "drama", "thriller"], "certification": "R", "title": "Those Who Wish Me Dead", "trailer": "http://www.youtube.com/watch?v=sV6VNNjBkcE", "images": ["poster": "http://image.tmdb.org/t/p/w780/xCEg6KowNISWvMh8GvPSxtdf9TO.jpg", "fanart": "http://image.tmdb.org/t/p/original/41HvtWz3RDHfvnSPahWJU8oMgKA.jpg"]], ["certification": "PG", "genres": ["adventure", "animation", "comedy", "family", "science fiction"], "year": "2021", "trailer": "http://www.youtube.com/watch?v=9c52Z5sMuTQ", "synopsis": "A quirky, dysfunctional family\'s road trip is upended when they find themselves in the middle of the robot apocalypse and suddenly become humanity\'s unlikeliest last hope.", "imdb_id": "tt7979580", "images": ["fanart": "http://image.tmdb.org/t/p/original/5g0gisu56NsCGiMa00HWINbc25X.jpg", "poster": "http://image.tmdb.org/t/p/w780/1RjkFdP1pQrqQ3DYKuxR9JnQ5JO.jpg"], "runtime": "114", "rating": ["percentage": 79.0], "title": "The Mitchells vs. The Machines"], ["rating": ["percentage": 76.0], "year": "2017", "images": ["poster": "http://image.tmdb.org/t/p/w780/rzRwTcFvttcN1ZpX2xv4j3tSdJu.jpg", "fanart": "http://image.tmdb.org/t/p/original/kaIfm5ryEOwYg8mLbq8HkPuM1Fo.jpg"], "imdb_id": "tt3501632", "synopsis": "Thor is imprisoned on the other side of the universe and finds himself in a race against time to get back to Asgard to stop Ragnarok, the destruction of his home-world and the end of Asgardian civilization, at the hands of a powerful new threat, the ruthless Hela.", "certification": "PG-13", "runtime": "131", "title": "Thor: Ragnarok", "trailer": "http://www.youtube.com/watch?v=ue80QwXMRHg", "genres": ["action", "adventure", "comedy", "fantasy", "science fiction"]], ["rating": ["percentage": 76.0], "trailer": "http://www.youtube.com/watch?v=wUn05hdkhjM", "imdb_id": "tt3896198", "synopsis": "The Guardians must fight to keep their newfound family together as they unravel the mysteries of Peter Quill\'s true parentage.", "runtime": "137", "genres": ["action", "adventure", "comedy", "science fiction"], "images": ["poster": "http://image.tmdb.org/t/p/w780/y4MBh0EjBlMuOzv9axM4qJlmhzz.jpg", "fanart": "http://image.tmdb.org/t/p/original/tM894AtE7UQTJEoQG6qF6mdfSUT.jpg"], "title": "Guardians of the Galaxy Vol. 2", "certification": "PG-13", "year": "2017"], ["title": "Kingsman: The Secret Service", "year": "2014", "rating": ["percentage": 76.0], "synopsis": "The story of a super-secret spy organization that recruits an unrefined but promising street kid into the agency\'s ultra-competitive training program just as a global threat emerges from a twisted tech genius.", "trailer": "http://www.youtube.com/watch?v=kl8F-8tR8to", "certification": "R", "imdb_id": "tt2802144", "runtime": "129", "images": ["poster": "http://image.tmdb.org/t/p/w780/ay7xwXn1G9fzX9TUBlkGA584rGi.jpg", "fanart": "http://image.tmdb.org/t/p/original/4PYZrUZZSS5dV3Tw7lEBnnlxrko.jpg"], "genres": ["action", "adventure", "comedy", "crime"]], ["title": "Fast & Furious Presents: Hobbs & Shaw", "imdb_id": "tt6806448", "runtime": "137", "synopsis": "Ever since US Diplomatic Security Service Agent Hobbs and lawless outcast Shaw first faced off, they just have traded smack talk and body blows. But when cyber-genetically enhanced anarchist Brixton\'s ruthless actions threaten the future of humanity, they join forces to defeat him.", "year": "2019", "images": ["poster": "http://image.tmdb.org/t/p/w780/qRyy2UmjC5ur9bDi3kpNNRCc5nc.jpg", "fanart": "http://image.tmdb.org/t/p/original/qAhedRxRYWZAgZ8O8pHIl6QHdD7.jpg"], "trailer": "http://www.youtube.com/watch?v=9SA7FaKxZVI", "certification": "PG-13", "genres": ["action", "adventure", "comedy"], "rating": ["percentage": 69.0]], ["images": ["poster": "http://image.tmdb.org/t/p/w780/ghXfkQLhlr0gDhgSIVsdSU2hFDV.jpg", "fanart": "http://image.tmdb.org/t/p/original/yNjUSw15d61CdWgt84mQFbXD6wQ.jpg"], "imdb_id": "tt14807808", "runtime": "0", "year": "2021", "certification": "", "genres": ["crime", "documentary"], "title": "The Housewife and the Hustler", "synopsis": "Go inside the real-life legal scandal facing the husband of “The Real Housewives of Beverly Hills” cast member Erika Jayne.", "trailer": "", "rating": ["percentage": 0.0]], ["year": "2018", "imdb_id": "tt4154756", "synopsis": "As the Avengers and their allies have continued to protect the world from threats too large for any one hero to handle, a new danger has emerged from the cosmic shadows: Thanos. A despot of intergalactic infamy, his goal is to collect all six Infinity Stones, artifacts of unimaginable power, and use them to inflict his twisted will on all of reality. Everything the Avengers have fought for has led up to this moment - the fate of Earth and existence itself has never been more uncertain.", "title": "Avengers: Infinity War", "images": ["poster": "http://image.tmdb.org/t/p/w780/7WsyChQLEftFiDOVTGkv3hFpyyt.jpg", "fanart": "http://image.tmdb.org/t/p/original/lmZFxXgJE3vgrciwuDib0N8CfQo.jpg"], "certification": "PG-13", "runtime": "149", "trailer": "http://www.youtube.com/watch?v=6ZfuNTqbHE8", "genres": ["action", "adventure", "science fiction"], "rating": ["percentage": 83.0]], ["year": "2002", "synopsis": "Cars fly, trees fight back, and a mysterious house-elf comes to warn Harry Potter at the start of his second year at Hogwarts. Adventure and danger await when bloody writing on a wall announces: The Chamber Of Secrets Has Been Opened. To save Hogwarts will require all of Harry, Ron and Hermione’s magical abilities and courage.", "rating": ["percentage": 77.0], "title": "Harry Potter and the Chamber of Secrets", "trailer": "http://www.youtube.com/watch?v=1bq0qff4iF8", "certification": "PG", "genres": ["adventure", "fantasy"], "imdb_id": "tt0295297", "runtime": "161", "images": ["poster": "http://image.tmdb.org/t/p/w780/sdEOH0992YZ0QSxgXNIGLq1ToUi.jpg", "fanart": "http://image.tmdb.org/t/p/original/1stUIsjawROZxjiCMtqqXqgfZWC.jpg"]], ["imdb_id": "tt7286456", "genres": ["crime", "drama", "thriller"], "rating": ["percentage": 82.0], "runtime": "122", "year": "2019", "trailer": "http://www.youtube.com/watch?v=t433PEQGErc", "certification": "R", "synopsis": "During the 1980s, a failed stand-up comedian is driven insane and turns to a life of crime and chaos in Gotham City while becoming an infamous psychopathic crime figure.", "title": "Joker", "images": ["fanart": "http://image.tmdb.org/t/p/original/f5F4cRhQdUbyVbB5lTNCwUzD6BP.jpg", "poster": "http://image.tmdb.org/t/p/w780/udDclJoHjfjb8Ekgsd4FDteOkCU.jpg"]], ["runtime": "101", "certification": "R", "synopsis": "Ex-hitman John Wick comes out of retirement to track down the gangsters that took everything from him.", "imdb_id": "tt2911666", "images": ["poster": "http://image.tmdb.org/t/p/w780/fZPSd91yGE9fCcCe6OoQr6E3Bev.jpg", "fanart": "http://image.tmdb.org/t/p/original/7dzngS8pLkGJpyeskCFcjPO9qLF.jpg"], "rating": ["percentage": 73.0], "genres": ["action", "thriller"], "year": "2014", "title": "John Wick", "trailer": "http://www.youtube.com/watch?v=2AUmvWm5ZDQ"], ["genres": ["action", "adventure", "fantasy"], "synopsis": "Young hobbit Frodo Baggins, after inheriting a mysterious ring from his uncle Bilbo, must leave his home in order to keep it from falling into the hands of its evil creator. Along the way, a fellowship is formed to protect the ringbearer and make sure that the ring arrives at its final destination: Mt. Doom, the only place where it can be destroyed.", "images": ["fanart": "http://image.tmdb.org/t/p/original/vRQnzOn4HjIMX4LBq9nHhFXbsSu.jpg", "poster": "http://image.tmdb.org/t/p/w780/6oom5QYQ2yQTMJIbnvbkBL9cHo6.jpg"], "certification": "PG-13", "trailer": "http://www.youtube.com/watch?v=V75dMMIW2B4", "rating": ["percentage": 83.0], "year": "2001", "runtime": "179", "imdb_id": "tt0120737", "title": "The Lord of the Rings: The Fellowship of the Ring"], ["title": "The Lord of the Rings: The Two Towers", "year": "2002", "runtime": "179", "synopsis": "Frodo and Sam are trekking to Mordor to destroy the One Ring of Power while Gimli, Legolas and Aragorn search for the orc-captured Merry and Pippin. All along, nefarious wizard Saruman awaits the Fellowship members at the Orthanc Tower in Isengard.", "trailer": "http://www.youtube.com/watch?v=-PAGAOrv6UI", "genres": ["action", "adventure", "fantasy"], "images": ["poster": "http://image.tmdb.org/t/p/w780/5VTN0pR8gcqV3EPUHHfMGnJYN9L.jpg", "fanart": "http://image.tmdb.org/t/p/original/kWYfW2Re0rUDE6IHhy4CRuKWeFr.jpg"], "rating": ["percentage": 83.0], "imdb_id": "tt0167261", "certification": "PG-13"], ["images": ["fanart": "http://image.tmdb.org/t/p/original/sd4xN5xi8tKRPrJOWwNiZEile7f.jpg", "poster": "http://image.tmdb.org/t/p/w780/qa6HCwP4Z15l3hpsASz3auugEW6.jpg"], "imdb_id": "tt0317219", "title": "Cars", "rating": ["percentage": 68.0], "genres": ["adventure", "animation", "comedy", "family"], "certification": "G", "synopsis": "Lightning McQueen, a hotshot rookie race car driven to succeed, discovers that life is about the journey, not the finish line, when he finds himself unexpectedly detoured in the sleepy Route 66 town of Radiator Springs. On route across the country to the big Piston Cup Championship in California to compete against two seasoned pros, McQueen gets to know the town\'s offbeat characters.", "runtime": "117", "year": "2006", "trailer": "http://www.youtube.com/watch?v=SbXIj2T-_uk"], ["title": "Bad Boys for Life", "runtime": "124", "synopsis": "Marcus and Mike are forced to confront new threats, career changes, and midlife crises as they join the newly created elite team AMMO of the Miami police department to take down the ruthless Armando Armas, the vicious leader of a Miami drug cartel.", "trailer": "http://www.youtube.com/watch?v=jKCj3XuPG8M", "rating": ["percentage": 72.0], "images": ["poster": "http://image.tmdb.org/t/p/w780/y95lQLnuNKdPAzw9F9Ab8kJ80c3.jpg", "fanart": "http://image.tmdb.org/t/p/original/3N316jUSdhvPyYTW29G4v9ebbcS.jpg"], "imdb_id": "tt1502397", "genres": ["action", "crime", "thriller"], "certification": "R", "year": "2020"], ["genres": ["action", "adventure", "fantasy", "science fiction"], "year": "2013", "trailer": "http://www.youtube.com/watch?v=KVu3gS7iJu4", "images": ["fanart": "http://image.tmdb.org/t/p/original/69EFgWWPFWbRNHmQgYdSnyJ94Ge.jpg", "poster": "http://image.tmdb.org/t/p/w780/4qgXzVAYNihFeudrys6WU4I01Q7.jpg"], "synopsis": "A young boy learns that he has extraordinary powers and is not of this earth. As a young man, he journeys to discover where he came from and what he was sent here to do. But the hero in him must emerge if he is to save the world from annihilation and become the symbol of hope for all mankind.", "imdb_id": "tt0770828", "rating": ["percentage": 66.0], "title": "Man of Steel", "certification": "", "runtime": "143"], ["certification": "", "images": ["fanart": "http://image.tmdb.org/t/p/original/tweDJNQzBGgsWVF5MC8JhSAk07p.jpg", "poster": "http://image.tmdb.org/t/p/w780/5EufsDwXdY2CVttYOk2WtYhgKpa.jpg"], "rating": ["percentage": 72.0], "synopsis": "When Cecilia\'s abusive ex takes his own life and leaves her his fortune, she suspects his death was a hoax. As a series of coincidences turn lethal, Cecilia works to prove that she is being hunted by someone nobody can see.", "genres": ["horror", "science fiction", "thriller"], "imdb_id": "tt1051906", "runtime": "124", "title": "The Invisible Man", "year": "2020", "trailer": "http://www.youtube.com/watch?v=dSBsNeYqh-k"], ["genres": ["action", "science fiction", "thriller"], "images": ["poster": "http://image.tmdb.org/t/p/w780/qvktm0BHcnmDpul4Hz01GIazWPr.jpg", "fanart": "http://image.tmdb.org/t/p/original/wh4ze6klUbeichAj603OKZwY1W5.jpg"], "title": "The Terminator", "trailer": "http://www.youtube.com/watch?v=k64P4l2Wmeg", "certification": "R", "synopsis": "In the post-apocalyptic future, reigning tyrannical supercomputers teleport a cyborg assassin known as the \"Terminator\" back to 1984 to kill Sarah Connor, whose unborn son is destined to lead insurgents against 21st century mechanical hegemony. Meanwhile, the human-resistance movement dispatches a lone warrior to safeguard Sarah. Can he stop the virtually indestructible killing machine?", "imdb_id": "tt0088247", "runtime": "108", "rating": ["percentage": 76.0], "year": "1984"], ["images": ["poster": "http://image.tmdb.org/t/p/w780/d4J7GotCjvDJBAYayZBTc5nLbbP.jpg", "fanart": "http://image.tmdb.org/t/p/original/77ElMccPnTMPouRxSdbJ4nEjf69.jpg"], "rating": ["percentage": 79.0], "year": "1998", "synopsis": "Jeffrey \'The Dude\' Lebowski, a Los Angeles slacker who only wants to bowl and drink White Russians, is mistaken for another Jeffrey Lebowski, a wheelchair-bound millionaire, and finds himself dragged into a strange series of events involving nihilists, adult film producers, ferrets, errant toes, and large sums of money.", "imdb_id": "tt0118715", "runtime": "117", "trailer": "http://www.youtube.com/watch?v=cd-go0oBF4Y", "title": "The Big Lebowski", "certification": "R", "genres": ["comedy", "crime"]], ["imdb_id": "tt7390646", "synopsis": "A fast-paced action thriller about a rookie cop who inadvertently captures the murder of a young drug dealer on her body cam. After realizing that the murder was committed by corrupt cops, she teams up with the one person from her community who is willing to help her as she tries to escape both the criminals out for revenge and the police who are desperate to destroy the incriminating footage.", "trailer": "http://www.youtube.com/watch?v=QCfSeVCr7ng", "year": "2019", "certification": "R", "genres": ["action", "thriller"], "runtime": "109", "rating": ["percentage": 67.0], "title": "Black and Blue", "images": ["poster": "http://image.tmdb.org/t/p/w780/1cSHEKYYP8Dpi4o1iBVd4U75FYt.jpg", "fanart": "http://image.tmdb.org/t/p/original/7GWDrjxeBsh5onaYf5XHjIM9BA1.jpg"]], ["synopsis": "A retired special forces officer is trapped in a never-ending time loop on the day of his death.", "year": "2021", "images": ["poster": "http://image.tmdb.org/t/p/w780/wKTsXAQvDy6uip7EiCvHUuCSQJX.jpg", "fanart": "http://image.tmdb.org/t/p/original/iueb8P2aSE2JL21kgoyhnmmeFb5.jpg"], "runtime": "100", "rating": ["percentage": 69.0], "genres": ["action", "mystery", "science fiction", "thriller"], "title": "Boss Level", "certification": "R", "imdb_id": "tt7638348", "trailer": "http://www.youtube.com/watch?v=9mkiY-37OG4"], ["images": ["fanart": "http://image.tmdb.org/t/p/original/fD5DcrZJFx31bDHYynV6BfHjfU0.jpg", "poster": "http://image.tmdb.org/t/p/w780/yCTo0s8xzQplZY5h70cRy2OA4Pt.jpg"], "year": "2021", "title": "Redemption Day", "trailer": "http://www.youtube.com/watch?v=TWjsU76dEIE", "rating": ["percentage": 71.0], "certification": "", "runtime": "100", "imdb_id": "tt4439620", "synopsis": "Having just returned home, decorated U.S. Marine Captain Brad Paxton\'s wife, Kate, is kidnapped by a terrorist group while working in Morocco. He is forced back into action for a daring and deadly operation to save the woman he loves.", "genres": ["action", "thriller"]], ["title": "F9", "synopsis": "Dominic Toretto is leading a quiet life off the grid with Letty and his son, little Brian, but they know that danger always lurks just over their peaceful horizon. This time, that threat will force Dom to confront the sins of his past if he’s going to save those he loves most. His crew joins together to stop a world-shattering plot led by the most skilled assassin and high-performance driver they’ve ever encountered: a man who also happens to be Dom’s forsaken brother, Jakob.", "year": "2021", "runtime": "145", "trailer": "http://www.youtube.com/watch?v=aSiDu3Ywi8E", "rating": ["percentage": 0.0], "certification": "PG-13", "images": ["poster": "http://image.tmdb.org/t/p/w780/qIicLxr7B7gIt5hxZxo423BJLlK.jpg", "fanart": "http://image.tmdb.org/t/p/original/xXHZeb1yhJvnSHPzZDqee0zfMb6.jpg"], "genres": ["action", "crime", "thriller"], "imdb_id": "tt5433138"], ["trailer": "http://www.youtube.com/watch?v=7tmxxzZXLEM", "runtime": "129", "year": "2021", "title": "The Mauritanian", "genres": ["drama"], "synopsis": "A detainee at the U.S military\'s Guantanamo Bay detention center is held without charges for over a decade and seeks help from a defense attorney for his release.", "imdb_id": "tt4761112", "certification": "", "images": ["poster": "http://image.tmdb.org/t/p/w780/lIADEa6oH74uUapjsPbNRzxus8M.jpg", "fanart": "http://image.tmdb.org/t/p/original/eLq6NEt3pwLvYrN5C6dPFcaTt7D.jpg"], "rating": ["percentage": 65.0]], ["title": "In The Heights", "year": "2021", "synopsis": "Usnavi, a bodega owner who is in the neighborhood of Washington Heights, looks after the aging Cuban lady next door and pines for the gorgeous girl working in the neighboring beauty salon and has dreams of winning the lottery and escaping to the shores of his native Dominican Republic. Meanwhile, Nina, a childhood friend of Usnavi\'s, has returned to the neighborhood from her first year at college with surprising news for her parents, who have spent their life savings on building a better life for their daughter. Ultimately, Usnavi and the residents of the close-knit neighborhood get a dose of what it means to be home.", "images": ["poster": "http://image.tmdb.org/t/p/w780/xpixGghWDGC549bOy7IEb4MzDlo.jpg", "fanart": "http://image.tmdb.org/t/p/original/idD0UckuTaqcs78ALRpi3dWTm9k.jpg"], "genres": ["drama", "music", "romance"], "runtime": "120", "rating": ["percentage": 0.0], "imdb_id": "tt1321510", "certification": "PG-13", "trailer": "http://www.youtube.com/watch?v=U0CL-ZSuCrQ"], ["imdb_id": "tt13067292", "images": ["poster": "http://image.tmdb.org/t/p/w780/h9RxMwjGBKEHZUl2wOTy8LpNP1p.jpg", "fanart": "http://image.tmdb.org/t/p/original/iE807wETqMxbVOgR1dLFWcGSNx8.jpg"], "trailer": "http://www.youtube.com/watch?v=sv-EkV3TuWM", "year": "2021", "title": "Rogue Hostage", "runtime": "0", "rating": ["percentage": 65.0], "certification": "", "synopsis": "Single father and former Marine Kyle Snowden is struggles to adjust to life with PTSD. On a routine stop for his job in Child Protective Services, Kyle finds himself and a group of innocent customers trapped inside his stepfather’s store during a hostile take-over by militant maniac Eagan Raize. Disturbing details emerge about Eagan’s violent vendetta against Kyle’s stepfather, Congressman Sam Nelson, threatening the lives of everyone inside, including the Congressman and Kyle’s young daughter. In a race against time, Kyle must battle against the terrorists as well as his personal demons to secure the store and save everyone.", "genres": ["action", "thriller"]], ["certification": "NR", "year": "2021", "runtime": "111", "rating": ["percentage": 70.0], "imdb_id": "tt11658120", "synopsis": "Two years after the murder of his son and father, a retired hitman sets in motion a carefully crafted revenge plan against the killer: his own brother.", "images": ["poster": "http://image.tmdb.org/t/p/w780/njKTjqWXfNhi2fu3J3i0pRbPSWj.jpg", "fanart": "http://image.tmdb.org/t/p/original/gGSm6ZmWtGazs2H1m0gOp7cx1ZZ.jpg"], "trailer": "http://www.youtube.com/watch?v=X2O1OW6i820", "title": "Xtreme", "genres": ["action", "adventure", "crime", "drama", "fantasy", "thriller"]], ["year": "2014", "images": ["fanart": "http://image.tmdb.org/t/p/original/mZSAu5acXueGC4Z3S5iLSWx8AEp.jpg", "poster": "http://image.tmdb.org/t/p/w780/r7vmZjiyZw9rpJMQJdXpjgiCOk9.jpg"], "title": "Guardians of the Galaxy", "imdb_id": "tt2015381", "genres": ["action", "adventure", "science fiction"], "trailer": "http://www.youtube.com/watch?v=b7yOuhI1dzU", "rating": ["percentage": 79.0], "certification": "PG-13", "runtime": "121", "synopsis": "Light years from Earth, 26 years after being abducted, Peter Quill finds himself the prime target of a manhunt after discovering an orb wanted by Ronan the Accuser."]]
